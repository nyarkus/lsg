# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è ext4
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å—á–∏—Ç–∞–µ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ –¥–∏—Å–∫ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ - –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä—É–µ—Ç. –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ext4 —É –º–µ–Ω—è –¥–∏—Å–∫–∏ –Ω–µ –æ—Å–æ–±–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç ntfs, –Ω–æ –≤—Å—ë –∂–µ.

```bash
#!/bin/bash

THRESHOLD=30 # (1)
TARGETS=( # (2)
    "/mnt/hdd/"
    "–µ—â—ë –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –¥–∏—Å–∫"
)

if ! command -v e4defrag &> /dev/null; then
    echo "‚ùå –£—Ç–∏–ª–∏—Ç–∞ e4defrag –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –£—Å—Ç–∞–Ω–æ–≤–∏ –µ—ë: sudo pacman -S e2fsprogs"
    exit 1
fi

for TARGET in "${TARGETS[@]}"; do
    if [ ! -d "$TARGET" ]; then
        echo "‚ùå –ü—É—Ç—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π: $TARGET"
        continue
    fi

    echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é: $TARGET"
    SCORE_LINE=$(sudo e4defrag -c "$TARGET" | grep "Fragmentation score")
    SCORE=$(echo "$SCORE_LINE" | grep -o '[0-9]\+')

    echo "üìä $TARGET ‚Üí fragmentation score: $SCORE"

    if [ "$SCORE" -gt "$THRESHOLD" ]; then
        echo "‚ö†Ô∏è  –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ $THRESHOLD. –ó–∞–ø—É—Å–∫–∞—é –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é..."
        sudo e4defrag "$TARGET"
        echo "‚úÖ –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è $TARGET"
    else
        echo "‚úÖ –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –Ω–æ—Ä–º–µ. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º $TARGET"
    fi

    echo "-----------------------------"
done
```

1. –ü–æ—Ä–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏. –£—Ç–∏–ª–∏—Ç–∞ `e4defrag` —Å–æ–≤–µ—Ç—É–µ—Ç –≤–æ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è: **[0-30 no problem: 31-55 a little bit fragmented: 56- needs defrag]**
2. –ú–∞—Å—Å–∏–≤ –ø–∞–ø–æ–∫

–ó–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞–¥–æ –æ—Ç root –ø—Ä–∞–≤. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å crontab (–ø–∞–∫–µ—Ç [cronie](https://archlinux.org/packages/?name=cronie), [–≥–∞–π–¥](https://wiki.archlinux.org/title/Cron#Basic_commands)):
```
@weekly /usr/local/bin/defrag.sh
```